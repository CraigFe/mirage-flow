<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>F (mirage-flow-lwt.Mirage_flow_lwt.F)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../../index.html">mirage-flow-lwt</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Mirage_flow_lwt.F</span></h1></header><p>In-memory, function-based flows.</p><div class="spec include"><div class="doc"></div><details open="open"><summary><span class="def"><code><span class="keyword">include </span><a href="../index.html#module-type-S">S</a></code></span></summary><div class="spec type" id="type-io"><a href="#type-io" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>'a io</code><code><span class="keyword"> = </span><span class="type-var">'a</span> Lwt.t</code><code></code></div><div class="doc"><p>The type for potentially blocking I/O operations.</p></div></div><div class="spec type" id="type-error"><a href="#type-error" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>error</code><code></code><code></code></div><div class="doc"><p>The type for flow errors.</p></div></div><div class="spec val" id="val-pp_error"><a href="#val-pp_error" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>pp_error : <a href="index.html#type-error">error</a> Fmt.t</code></div><div class="doc"><p><code class="code">pp_error</code> is the pretty-printer for errors.</p></div></div><div class="spec type" id="type-write_error"><a href="#type-write_error" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>write_error</code><span class="keyword"> = </span><span class="keyword">private </span><code>[&gt; </code><table class="variant"><tr id="type-write_error.Mirage_flow.write_error" class="anchored"><td class="def type"><a href="#type-write_error.Mirage_flow.write_error" class="anchor"></a><code><span class="keyword">| </span></code><code><a href="../../../mirage-flow/Mirage_flow/index.html#type-write_error">Mirage_flow.write_error</a></code></td></tr></table><code> ]</code><code></code></div><div class="doc"><p>The type for write errors.</p></div></div><div class="spec val" id="val-pp_write_error"><a href="#val-pp_write_error" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>pp_write_error : <a href="index.html#type-write_error">write_error</a> Fmt.t</code></div><div class="doc"><p><code class="code">pp_write_error</code> is the pretty-printer for write errors.</p></div></div><div class="spec type" id="type-buffer"><a href="#type-buffer" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>buffer</code><code><span class="keyword"> = </span>Cstruct.t</code><code></code></div><div class="doc"><p>The type for memory buffer.</p></div></div><div class="spec type" id="type-flow"><a href="#type-flow" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>flow</code><code></code><code></code></div><div class="doc"><p>The type for flows. A flow represents the state of a single
reliable stream that is connected to an endpoint.</p></div></div><div class="spec val" id="val-read"><a href="#val-read" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>read : <a href="index.html#type-flow">flow</a> <span class="keyword">&#8209;&gt;</span> (<a href="index.html#type-buffer">buffer</a> <a href="../../../mirage-flow/Mirage_flow/index.html#type-or_eof">Mirage_flow.or_eof</a>, <a href="index.html#type-error">error</a>) Result.result <a href="index.html#type-io">io</a></code></div><div class="doc"><p><code class="code">read flow</code> blocks until some data is available and returns a
fresh buffer containing it.</p><p>The returned buffer will be of a size convenient to the flow
implementation, but will always have at least 1 byte.</p><p>If the remote endpoint calls <code class="code">close</code> then calls to <code class="code">read</code> will
keep returning data until all the in-flight data has been read.
<code class="code">read flow</code> will return <code class="code">`Eof</code> when the remote endpoint has
called <code class="code">close</code> and when there is no more in-flight data.</p></div></div><div class="spec val" id="val-write"><a href="#val-write" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>write : <a href="index.html#type-flow">flow</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-buffer">buffer</a> <span class="keyword">&#8209;&gt;</span> (unit, <a href="index.html#type-write_error">write_error</a>) Result.result <a href="index.html#type-io">io</a></code></div><div class="doc"><p><code class="code">write flow buffer</code> writes a buffer to the flow. There is no
indication when the buffer has actually been read and, therefore,
it must not be reused. The contents may be transmitted in
separate packets, depending on the underlying transport. The
result <code class="code">Ok ()</code> indicates success, <code class="code">Error `Closed</code> indicates that the
connection is now closed and therefore the data could not be
written. Other errors are possible.</p></div></div><div class="spec val" id="val-writev"><a href="#val-writev" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>writev : <a href="index.html#type-flow">flow</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-buffer">buffer</a> list <span class="keyword">&#8209;&gt;</span> (unit, <a href="index.html#type-write_error">write_error</a>) Result.result <a href="index.html#type-io">io</a></code></div><div class="doc"><p><code class="code">writev flow buffers</code> writes a sequence of buffers to the flow.
There is no indication when the buffers have actually been read and,
therefore, they must not be reused. The
result <code class="code">Ok ()</code> indicates success, <code class="code">Error `Closed</code> indicates that the
connection is now closed and therefore the data could not be
written. Other errors are possible.</p></div></div><div class="spec val" id="val-close"><a href="#val-close" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>close : <a href="index.html#type-flow">flow</a> <span class="keyword">&#8209;&gt;</span> unit <a href="index.html#type-io">io</a></code></div><div class="doc"><p><code class="code">close flow</code> flushes all pending writes and signals the remote
endpoint that there will be no future writes. Once the remote endpoint
has read all pending data, it is expected that calls to <code class="code">read</code> on
the remote return <code class="code">`Eof</code>.</p><p>Note it is still possible for the remote endpoint to <code class="code">write</code> to
the flow and for the local endpoint to call <code class="code">read</code>. This state where
the local endpoint has called <code class="code">close</code> but the remote endpoint
has not called <code class="code">close</code> is similar to that of a half-closed TCP
connection or a Unix socket after <code class="code">shutdown(SHUTDOWN_WRITE)</code>.</p><p><code class="code">close flow</code> waits until the remote endpoint has also called <code class="code">close</code>
before returning. At this point no data can flow in either direction
and resources associated with the flow can be freed.</p></div></div></details></div><div class="spec type" id="type-refill"><a href="#type-refill" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>refill</code><code><span class="keyword"> = </span>Cstruct.t <span class="keyword">&#8209;&gt;</span> int <span class="keyword">&#8209;&gt;</span> int <span class="keyword">&#8209;&gt;</span> int Lwt.t</code><code></code></div><div class="doc"><p>The type for refill functions.</p></div></div><div class="spec val" id="val-make"><a href="#val-make" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>make : ?&#8288;close:(unit <span class="keyword">&#8209;&gt;</span> unit Lwt.t) <span class="keyword">&#8209;&gt;</span> ?&#8288;input:<a href="index.html#type-refill">refill</a> <span class="keyword">&#8209;&gt;</span> ?&#8288;output:<a href="index.html#type-refill">refill</a> <span class="keyword">&#8209;&gt;</span> unit <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-flow">flow</a></code></div><div class="doc"><p><code class="code">make ~close ~input ~output ()</code> is a flow using <code class="code">input</code> to
refill its internal input buffer when needed and <code class="code">output</code> to
refill its external output buffer. It is using <code class="code">close</code> to
eventually clean-up other resources on close.</p></div></div><h2>String flows</h2><div class="spec val" id="val-input_string"><a href="#val-input_string" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>input_string : string <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-refill">refill</a></code></div><div class="doc"><p><code class="code">input_string buf</code> is the refill function reading its inputs
from the string <code class="code">buf</code>.</p></div></div><div class="spec val" id="val-output_bytes"><a href="#val-output_bytes" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>output_bytes : bytes <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-refill">refill</a></code></div><div class="doc"><p><code class="code">output_bytes buf</code> is the refill function writing its outputs in
the buffer <code class="code">buf</code>.</p></div></div><div class="spec val" id="val-string"><a href="#val-string" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>string : ?&#8288;input:string <span class="keyword">&#8209;&gt;</span> ?&#8288;output:bytes <span class="keyword">&#8209;&gt;</span> unit <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-flow">flow</a></code></div><div class="doc"><p>The flow built using <a href="index.html#val-input_string">input_string</a> and <a href="index.html#val-output_bytes">output_bytes</a>.</p></div></div><div class="spec val" id="val-input_strings"><a href="#val-input_strings" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>input_strings : string list <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-refill">refill</a></code></div><div class="doc"><p><code class="code">input_strings bufs</code> is the refill function reading its inputs
from the list of buffers <code class="code">bufs</code>. Empty strings are ignored.</p></div></div><div class="spec val" id="val-output_bytess"><a href="#val-output_bytess" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>output_bytess : bytes list <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-refill">refill</a></code></div><div class="doc"><p><code class="code">output_bytess buf</code> is the refill function writing its outputs in
the list of buffers <code class="code">buf</code>. Empty strings are ignored.</p></div></div><div class="spec val" id="val-strings"><a href="#val-strings" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>strings : ?&#8288;input:string list <span class="keyword">&#8209;&gt;</span> ?&#8288;output:bytes list <span class="keyword">&#8209;&gt;</span> unit <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-flow">flow</a></code></div><div class="doc"><p>The flow built using <a href="index.html#val-input_strings">input_strings</a> and <a href="index.html#val-output_bytess">output_bytess</a>.</p></div></div><h2>Cstruct buffers flows</h2><div class="spec val" id="val-input_cstruct"><a href="#val-input_cstruct" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>input_cstruct : Cstruct.t <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-refill">refill</a></code></div><div class="doc"><p>Same as <a href="index.html#val-input_string">input_string</a> but for Cstruct.t buffers.</p></div></div><div class="spec val" id="val-output_cstruct"><a href="#val-output_cstruct" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>output_cstruct : Cstruct.t <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-refill">refill</a></code></div><div class="doc"><p>Same as output_string buf for Cstruct.t buffers.</p></div></div><div class="spec val" id="val-cstruct"><a href="#val-cstruct" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>cstruct : ?&#8288;input:Cstruct.t <span class="keyword">&#8209;&gt;</span> ?&#8288;output:Cstruct.t <span class="keyword">&#8209;&gt;</span> unit <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-flow">flow</a></code></div><div class="doc"><p>Same as <a href="index.html#val-string">string</a> but for Cstruct.t buffers.</p></div></div><div class="spec val" id="val-input_cstructs"><a href="#val-input_cstructs" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>input_cstructs : Cstruct.t list <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-refill">refill</a></code></div><div class="doc"><p>Same as <a href="index.html#val-input_strings">input_strings</a> but for Cstruct.t buffers.</p></div></div><div class="spec val" id="val-output_cstructs"><a href="#val-output_cstructs" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>output_cstructs : Cstruct.t list <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-refill">refill</a></code></div><div class="doc"><p>Same as output_strings but for Cstruct.t buffers.</p></div></div><div class="spec val" id="val-cstructs"><a href="#val-cstructs" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>cstructs : ?&#8288;input:Cstruct.t list <span class="keyword">&#8209;&gt;</span> ?&#8288;output:Cstruct.t list <span class="keyword">&#8209;&gt;</span> unit <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-flow">flow</a></code></div><div class="doc"><p>Same as <a href="index.html#val-strings">strings</a> but for Cstruct.t buffers.</p></div></div></body></html>